# Gradle Concepts
### Project Features
- Project was initially created using the [`gradle init` command](https://docs.gradle.org/current/samples/sample_building_java_libraries.html)
- Uses the [Gradle Wrapper](https://docs.gradle.org/current/userguide/gradle_wrapper.html)
- The project has dependencies, and those JAR files are retrieved from a repository 
- The Gradle script accepts parameters of either 'test' or 'staging' to indicate the test environment to be used
- Properties can be expressed as command line parameters, environment variables, or in Gradle property files
- The script, builds a jar file with version number, runs test cases and generates reports
- A subset of testcases can be run based on tag
- Checkstyle and SpotBugs plugins are used

### Create a Gradle skeleton project using the `gradle init` command
- Install `gradle`. I used [Homebrew](https://brew.sh/) to do it.
- Create a project folder (for this project I created: `gradle-concepts`), and `cd` into it.
- Run `gradle init --type java-library`. I selected defaults for all the prompts except: Test Framework I selected JUnit Jupiter; and Source Package I named `org.example`.
- This creates the skeleton of a Java library type project. It also sets up the Gradle wrapper.
- More info: https://docs.gradle.org/current/userguide/build_init_plugin.html

### Gradle Wrapper
- It's a best practice to set the version of Gradle using the [Gradle Wrapper](https://docs.gradle.org/current/userguide/gradle_wrapper.html).
- The version is set in the `gradle/wrapper/gradle-wrapper.properties` file and checked into source control. This way everyone working on the project will use the same version of Gradle.
- `./gradlew --version` displays the version of the Gradle wrapper.
- `./gradlew wrapper --gradle-version 7.0` updates the Gradle wrapper version to 7.0 by updating the `gradle-wrapper.properties` file.

### Common Configuration
- Specify a version number for the name of the generated jar file using the `version` property in `build.gradle`
- By default, the jar file is the same name as the root project folder. I overrode that by specifying `rootProject.name = 'gradle-demo'` in the `settings.gradle` file.
- After successfully running the build, running it again won't re-run the test cases. To always run the test cases, add `dependsOn 'cleanTest'` to `test` task in `build.gradle`
- See `build.gradle` for how I added test reporting

### Gradle Project Properties
This demo uses a Gradle project property called `platform` to simulate a scenario where testcases can use the property to determine which test server to run against.  The property must be one of two allowed values: `staging` and `test`. The Gradle build script exits with an error if neither of the allowed values exist.

Here are the ways to pass the property to the Gradle build, in order of precedence:
1. Command line property: `./gradlew build -Pplatform=staging`
2. Java system property: `./gradlew build -Dorg.gradle.project.platform=staging`. However, I read that Gradle may fork the build in a new JVM, so the -D argument may not be passed along.
3. Environment variable: `ORG_GRADLE_PROJECT_platform=staging ./gradlew build`
4. User `gradle.properties` file, usually in `~/.gradle/gradle.properties`, add value to file: `platform=staging`
4. Project `gradle.properties` file, in project root directory, add value to file: `platform=staging`

For this project, I set a default value of `platform=test` in the project `gradle.properties` file.

### Run the build
- Run `./gradlew build` from command line to build the jar file and run tests.
- Useful files generated by the build:
    - `build/libs/gradle-demo-0.1.0.jar`
    - `build/reports/tests/test/index.html` Report of test results

###  Run tests
- Run all tests from command line: `./gradlew test`. This runs the Gradle `test` task and doesn't specify the `platform` project property, thus using the default
- Override the default, specifying 'staging' for project property: `./gradlew test -Pplatform=staging`
- Run a single test case: `./gradlew test --tests org.example.LibraryTest.testAddNumbers`
- Run all tests in a class: `./gradlew test --tests org.example.LibraryTest`
- Run only tests tagged with `it` (integration tests): `./gradlew build -Ptype=it`   
- From IntelliJ: Create a run configuration for the `test` folder by right-clicking on `src/test` and selecting `Run...`. 

### Miscellaneous Tasks
- See what tasks you can run: `./gradlew tasks`
- Clear gradle cache: `./gradlew --refresh-dependencies`
- Clear gradle cache (brute force): `rm -rf $HOME/.gradle/caches`
